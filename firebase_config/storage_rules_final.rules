rules_version = '2';

// üöó AUTOMARKET - REGLAS DE FIREBASE STORAGE
// Configuraci√≥n para galer√≠a de veh√≠culos y sistema de publicidad

service firebase.storage {
  match /b/{bucket}/o {
    
    // ==========================================
    // üöó GALER√çA DE VEH√çCULOS
    // ==========================================
    
    // Fotos y videos de veh√≠culos
    match /vehicles/{vehicleId}/gallery/{fileId} {
      // Permitir lectura a todos (para mostrar en marketplace)
      allow read: if true;
      
      // Permitir escritura solo al propietario del veh√≠culo
      allow write: if request.auth != null 
                  && request.auth.uid == resource.metadata.ownerId;
      
      // Permitir subida de archivos nuevos
      allow create: if request.auth != null 
                   && request.resource.size < 50 * 1024 * 1024 // 50MB max
                   && request.resource.contentType.matches('image/.*|video/.*')
                   && request.resource.metadata.ownerId == request.auth.uid;
    }
    
    // ==========================================
    // üì¢ SISTEMA DE PUBLICIDAD
    // ==========================================
    
    // Banners publicitarios
    match /advertisements/{adId}/banner.{extension} {
      // Permitir lectura a todos (para mostrar anuncios)
      allow read: if true;
      
      // Permitir escritura solo al anunciante autenticado
      allow write: if request.auth != null 
                  && request.resource.size < 10 * 1024 * 1024 // 10MB max para banners
                  && request.resource.contentType.matches('image/.*')
                  && request.resource.metadata.advertiserId == request.auth.uid;
    }
    
    // ==========================================
    // üë§ PERFILES DE USUARIOS
    // ==========================================
    
    // Fotos de perfil de usuarios
    match /users/{userId}/profile/{fileId} {
      // Permitir lectura a todos
      allow read: if true;
      
      // Permitir escritura solo al propio usuario
      allow write: if request.auth != null 
                  && request.auth.uid == userId
                  && request.resource.size < 5 * 1024 * 1024 // 5MB max
                  && request.resource.contentType.matches('image/.*');
    }
    
    // ==========================================
    // üîß ARCHIVOS TEMPORALES
    // ==========================================
    
    // Archivos temporales durante upload
    match /temp/{userId}/{fileId} {
      // Solo el usuario puede acceder a sus archivos temporales
      allow read, write: if request.auth != null 
                        && request.auth.uid == userId
                        && request.resource.size < 50 * 1024 * 1024; // 50MB max
    }
    
    // ==========================================
    // üì± RECURSOS DE LA APP
    // ==========================================
    
    // Logo y recursos est√°ticos de la app
    match /app-assets/{fileName} {
      // Permitir lectura a todos
      allow read: if true;
      
      // Solo administradores pueden modificar recursos de la app
      allow write: if request.auth != null 
                  && request.auth.token.admin == true;
    }
    
    // ==========================================
    // üö® REGLAS DE SEGURIDAD
    // ==========================================
    
    // Denegar acceso a cualquier otra ruta
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
